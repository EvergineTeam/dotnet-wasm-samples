<Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">

  <ItemGroup>
    <ProjectReference Include="..\filesystem.tasks\Wasm.FileSystem.Tasks.csproj">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </ProjectReference>
  </ItemGroup>

  <UsingTask TaskName="FilePackagerTask"
    AssemblyFile = "$(OutDir)Wasm.FileSystem.Tasks.dll"/>

  <PropertyGroup>
    <TargetFramework>net6.0</TargetFramework>
  </PropertyGroup>

  <PropertyGroup>
    <PublishTrimmed>false</PublishTrimmed>
    <UsingBrowserRuntimeWorkload>true</UsingBrowserRuntimeWorkload>
    <!-- <WasmBuildNative>true</WasmBuildNative> -->
    <!-- <RunAOTCompilation>true</RunAOTCompilation> -->
  </PropertyGroup>

  <ItemGroup>
    <WasmFilesToIncludeInFileSystem Include="file.txt"/>
  </ItemGroup>

  <ItemGroup>
    <Content Include="file.txt" />
  </ItemGroup>

  <ItemGroup>
    <FrameworkReference Update="Microsoft.NETCore.App" RuntimeFrameworkVersion="6.0.0-rc.1.21401.1" />
    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly" Version="6.0.0-rc.1.21381.3" />
    <!-- <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly.DevServer" Version="6.0.0-rc.1.21381.3" PrivateAssets="all" /> -->
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.Build.Utilities.Core" Version="16.8.0" />
  </ItemGroup>

  <PropertyGroup>
    <DataTarget>$(OutDir)wwwroot/content.dat</DataTarget>
    <Preload>$(OutDir)wwwroot/file.txt</Preload>
    <JsOutput>$(OutDir)wwwroot/content.js</JsOutput>
    <NoHeapCopy>true</NoHeapCopy>
  </PropertyGroup>

  <Target Name="FilePackager" AfterTargets="Build">
    <FilePackagerTask
        DataTargetPath="$(DataTarget)"
        PreloadPath="$(Preload)"
        JsOutput="$(JsOutput)"
        NoHeapCopy="$(NoHeapCopy)"
        SeparateMetadata="$(SeparateMetadata)" />
  </Target>

</Project>